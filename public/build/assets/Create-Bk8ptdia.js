import{k as B,_ as Q,$ as Z,l as G,a0 as O,u as s,s as tt,r as U,c as i,o as l,b as E,h as et,w as D,a as t,d as C,i as y,f as A,t as f,T as ot,F as j,e as L,n as rt,a1 as st,p as at,g as H}from"./app-D6fBSztB.js";import{_ as nt}from"./AuthenticatedLayout-_MACS7lg.js";import"./ApplicationLogo-Dh4pLsNN.js";import"./_plugin-vue_export-helper-DlAUqK2U.js";function it(n){return Q()?(Z(n),!0):!1}const X=typeof window<"u"&&typeof document<"u";typeof WorkerGlobalScope<"u"&&globalThis instanceof WorkerGlobalScope;const lt=Object.prototype.toString,dt=n=>lt.call(n)==="[object Object]",M=()=>{},ut=ct();function ct(){var n,g;return X&&((n=window==null?void 0:window.navigator)==null?void 0:n.userAgent)&&(/iP(?:ad|hone|od)/.test(window.navigator.userAgent)||((g=window==null?void 0:window.navigator)==null?void 0:g.maxTouchPoints)>2&&/iPad|Macintosh/.test(window==null?void 0:window.navigator.userAgent))}function F(n){return Array.isArray(n)?n:[n]}function mt(n,g,b){return B(n,g,{...b,immediate:!0})}const Y=X?window:void 0;function P(n){var g;const b=O(n);return(g=b==null?void 0:b.$el)!=null?g:b}function $(...n){const g=[],b=()=>{g.forEach(m=>m()),g.length=0},o=(m,d,p,v)=>(m.addEventListener(d,p,v),()=>m.removeEventListener(d,p,v)),x=G(()=>{const m=F(O(n[0])).filter(d=>d!=null);return m.every(d=>typeof d!="string")?m:void 0}),T=mt(()=>{var m,d;return[(d=(m=x.value)==null?void 0:m.map(p=>P(p)))!=null?d:[Y].filter(p=>p!=null),F(O(x.value?n[1]:n[0])),F(s(x.value?n[2]:n[1])),O(x.value?n[3]:n[2])]},([m,d,p,v])=>{if(b(),!(m!=null&&m.length)||!(d!=null&&d.length)||!(p!=null&&p.length))return;const S=dt(v)?{...v}:v;g.push(...m.flatMap(h=>d.flatMap(w=>p.map(u=>o(h,w,u,S)))))},{flush:"post"}),k=()=>{T(),b()};return it(b),k}let R=!1;function gt(n,g,b={}){const{window:o=Y,ignore:x=[],capture:T=!0,detectIframe:k=!1,controls:m=!1}=b;if(!o)return m?{stop:M,cancel:M,trigger:M}:M;if(ut&&!R){R=!0;const e={passive:!0};Array.from(o.document.body.children).forEach(a=>a.addEventListener("click",M,e)),o.document.documentElement.addEventListener("click",M,e)}let d=!0;const p=e=>O(x).some(a=>{if(typeof a=="string")return Array.from(o.document.querySelectorAll(a)).some(c=>c===e.target||e.composedPath().includes(c));{const c=P(a);return c&&(e.target===c||e.composedPath().includes(c))}});function v(e){const a=O(e);return a&&a.$.subTree.shapeFlag===16}function S(e,a){const c=O(e),_=c.$.subTree&&c.$.subTree.children;return _==null||!Array.isArray(_)?!1:_.some(I=>I.el===a.target||a.composedPath().includes(I.el))}const h=e=>{const a=P(n);if(e.target!=null&&!(!(a instanceof Element)&&v(n)&&S(n,e))&&!(!a||a===e.target||e.composedPath().includes(a))){if("detail"in e&&e.detail===0&&(d=!p(e)),!d){d=!0;return}g(e)}};let w=!1;const u=[$(o,"click",e=>{w||(w=!0,setTimeout(()=>{w=!1},0),h(e))},{passive:!0,capture:T}),$(o,"pointerdown",e=>{const a=P(n);d=!p(e)&&!!(a&&!e.composedPath().includes(a))},{passive:!0}),k&&$(o,"blur",e=>{setTimeout(()=>{var a;const c=P(n);((a=o.document.activeElement)==null?void 0:a.tagName)==="IFRAME"&&!(c!=null&&c.contains(o.document.activeElement))&&g(e)},0)},{passive:!0})].filter(Boolean),r=()=>u.forEach(e=>e());return m?{stop:r,cancel:()=>{d=!1},trigger:e=>{d=!0,h(e),d=!1}}:r}const pt={class:"flex items-center justify-between"},ft={class:"flex items-center gap-4"},yt=["disabled"],xt={class:"py-8"},bt={class:"max-w-4xl mx-auto sm:px-6 lg:px-8 space-y-6"},vt={class:"bg-white dark:bg-gray-800 shadow sm:rounded-lg"},ht={class:"p-6 grid grid-cols-1 md:grid-cols-2 gap-6"},kt={key:0,class:"mt-1 text-sm text-red-600"},wt={key:0,class:"absolute z-10 mt-1 w-full bg-white dark:bg-gray-900 shadow-lg rounded-md border dark:border-gray-700 max-h-60 overflow-y-auto"},_t={class:"py-1"},Ct={key:0,class:"px-4 py-2 text-sm text-gray-500"},At=["onClick"],Ot={key:0,class:"mt-1 text-sm text-red-600"},Tt={class:"relative mt-1"},It={key:0,class:"mt-1 text-sm text-red-600"},Mt={class:"bg-white dark:bg-gray-800 shadow sm:rounded-lg"},St={class:"p-6 space-y-6"},jt={class:"mt-2"},Pt={class:"grid grid-cols-2 md:grid-cols-4 gap-3"},Nt=["value"],Vt={class:"text-sm font-medium text-gray-900 dark:text-gray-200"},Ut={class:"grid grid-cols-1 md:grid-cols-2 gap-6 pt-4 border-t dark:border-gray-700"},Et={key:0},Dt={class:"block text-sm font-medium text-gray-700 dark:text-gray-300"},Lt={class:"relative mt-1"},Ft={key:0,class:"mt-1 text-sm text-red-600"},$t={key:1},Bt={key:0,class:"mt-1 text-sm text-red-600"},Gt={key:2},zt={class:"relative mt-1"},Wt={key:0,class:"mt-1 text-sm text-red-600"},Ht={key:0,class:"mt-1 text-sm text-red-600"},Rt={class:"bg-white dark:bg-gray-800 shadow sm:rounded-lg"},Xt={class:"p-6 border-b dark:border-gray-700"},Yt={class:"text-sm text-gray-500 mt-1"},qt={key:0},Jt={key:1},Kt={class:"p-6 space-y-4 text-sm bg-gray-50/50 dark:bg-gray-900/20"},Qt={class:"flex justify-between font-bold text-lg"},Zt={class:"text-emerald-600 dark:text-emerald-400"},te={class:"overflow-x-auto"},ee={class:"min-w-full"},oe={class:"divide-y divide-gray-200 dark:divide-gray-700"},re={key:0},se={class:"px-4 py-2 text-sm font-mono text-gray-500"},ae={class:"px-4 py-2 text-sm"},ne={class:"px-4 py-2 text-sm text-right font-mono"},ie={key:0,class:"bg-gray-100 dark:bg-gray-700"},le={class:"px-4 py-2 text-right text-sm font-semibold font-mono"},de={key:1,class:"p-10 text-center text-gray-500"},ue={class:"bg-white dark:bg-gray-800 shadow sm:rounded-lg p-4"},ce=["disabled"],xe={__name:"Create",props:{clientes:{type:Array,default:()=>[]},modalidades:{type:Array,default:()=>[]}},setup(n){const g=n,o=tt({cliente_id:null,monto_total:null,anticipo:0,modalidad:"CUOTAS",cuotas:12,inicio:new Date().toISOString().slice(0,10),nota:"",porcentaje_litis:null}),x=U(""),T=U(""),k=U(!1),m=U(null),d=G(()=>x.value?g.clientes.filter(u=>u.nombre.toLowerCase().includes(x.value.toLowerCase())).slice(0,10):g.clientes.slice(0,10)),p=u=>{o.cliente_id=u.id,T.value=u.nombre,x.value=u.nombre,k.value=!1};B(x,u=>{u!==T.value&&(o.cliente_id=null)}),gt(m,()=>k.value=!1);const v=u=>new Intl.NumberFormat("es-CO",{style:"currency",currency:"COP",maximumFractionDigits:0}).format(Number(u||0));B(()=>o.modalidad,u=>{u==="LITIS"?(o.monto_total=null,o.cuotas=1):u==="PAGO_UNICO"?(o.cuotas=1,o.porcentaje_litis=null):u==="CUOTAS"&&(o.porcentaje_litis=null)});const S=(u,r)=>{if(!u)return"";const e=new Date(u.replace(/-/g,"/")),a=e.getDate(),c=new Date(e);c.setMonth(e.getMonth()+r);const _=new Date(c.getFullYear(),c.getMonth()+1,0).getDate();c.setDate(Math.min(a,_));const I=String(c.getMonth()+1).padStart(2,"0"),N=String(c.getDate()).padStart(2,"0");return`${c.getFullYear()}-${I}-${N}`},h=G(()=>{const u=Number(o.monto_total||0),r=Number(o.anticipo||0),e=Math.max(0,u-r),a=Math.max(1,parseInt(o.cuotas||1,10));if(!o.inicio||e<=0||!o.monto_total)return{neto:e,cuotas:a,filas:[],totalCuotas:0};if(o.modalidad==="PAGO_UNICO")return{neto:e,cuotas:1,filas:[{numero:1,fecha:o.inicio,valor:e}],totalCuotas:e};const c=Math.round(e*100),_=Math.floor(c/a),I=c-_*a,N=Array.from({length:a},(z,V)=>{const W=V+1,J=(_+(W<=I?1:0))/100,K=S(o.inicio,V);return{numero:W,fecha:K,valor:J}}),q=N.reduce((z,V)=>z+V.valor,0);return{neto:e,cuotas:a,filas:N,totalCuotas:q}}),w=()=>{o.post(route("honorarios.contratos.store"),{preserveScroll:!0})};return(u,r)=>(l(),i(j,null,[E(s(et),{title:"Nuevo Contrato · Honorarios"}),E(nt,null,{header:D(()=>[t("div",pt,[r[11]||(r[11]=t("h2",{class:"font-semibold text-xl text-gray-800 dark:text-gray-200"},"Crear Nuevo Contrato",-1)),t("div",ft,[E(s(at),{href:u.route("honorarios.contratos.index"),class:"text-sm font-medium text-gray-600 dark:text-gray-400 hover:text-gray-900 dark:hover:text-gray-200"},{default:D(()=>r[9]||(r[9]=[H(" Cancelar ",-1)])),_:1,__:[9]},8,["href"]),t("button",{onClick:w,disabled:s(o).processing,class:"inline-flex items-center gap-2 px-4 py-2 rounded-md text-sm font-semibold text-white bg-indigo-600 hover:bg-indigo-700 disabled:opacity-50 transition-colors"},r[10]||(r[10]=[t("svg",{xmlns:"http://www.w3.org/2000/svg",class:"h-4 w-4",fill:"none",viewBox:"0 0 24 24",stroke:"currentColor"},[t("path",{"stroke-linecap":"round","stroke-linejoin":"round","stroke-width":"2",d:"M8 7H5a2 2 0 00-2 2v9a2 2 0 002 2h14a2 2 0 002-2V9a2 2 0 00-2-2h-3m-1 4l-3 3m0 0l-3-3m3 3V4"})],-1),H(" Guardar Contrato ",-1)]),8,yt)])])]),default:D(()=>[t("div",xt,[t("div",bt,[t("div",vt,[r[16]||(r[16]=t("div",{class:"p-6 border-b dark:border-gray-700 flex items-center gap-3"},[t("div",{class:"bg-indigo-100 dark:bg-indigo-900/50 p-2 rounded-lg"},[t("svg",{xmlns:"http://www.w3.org/2000/svg",class:"h-6 w-6 text-indigo-600 dark:text-indigo-300",fill:"none",viewBox:"0 0 24 24",stroke:"currentColor"},[t("path",{"stroke-linecap":"round","stroke-linejoin":"round","stroke-width":"2",d:"M9 12h6m-6 4h6m2 5H7a2 2 0 01-2-2V5a2 2 0 012-2h5.586a1 1 0 01.707.293l5.414 5.414a1 1 0 01.293.707V19a2 2 0 01-2 2z"})])]),t("h3",{class:"text-lg font-semibold text-gray-800 dark:text-gray-200"},"Información Principal")],-1)),t("div",ht,[t("div",{class:"md:col-span-2 relative",ref_key:"clientDropdown",ref:m},[r[12]||(r[12]=t("label",{class:"block text-sm font-medium text-gray-700 dark:text-gray-300"},"Cliente *",-1)),C(t("input",{type:"text","onUpdate:modelValue":r[0]||(r[0]=e=>x.value=e),onFocus:r[1]||(r[1]=e=>k.value=!0),placeholder:"Escribe para buscar un cliente...",class:"mt-1 w-full rounded-md border-gray-300 dark:border-gray-600 dark:bg-gray-900 shadow-sm focus:ring-indigo-500 focus:border-indigo-500"},null,544),[[A,x.value]]),s(o).errors.cliente_id?(l(),i("p",kt,f(s(o).errors.cliente_id),1)):y("",!0),E(ot,{"enter-active-class":"transition ease-out duration-100","enter-from-class":"transform opacity-0 scale-95","enter-to-class":"transform opacity-100 scale-100","leave-active-class":"transition ease-in duration-75","leave-from-class":"transform opacity-100 scale-100","leave-to-class":"transform opacity-0 scale-95"},{default:D(()=>[k.value?(l(),i("div",wt,[t("ul",_t,[d.value.length===0?(l(),i("li",Ct,"No hay coincidencias")):y("",!0),(l(!0),i(j,null,L(d.value,e=>(l(),i("li",{key:e.id,onClick:a=>p(e),class:"px-4 py-2 text-sm text-gray-700 dark:text-gray-300 hover:bg-indigo-500 hover:text-white dark:hover:bg-indigo-600 cursor-pointer"},f(e.nombre),9,At))),128))])])):y("",!0)]),_:1})],512),t("div",null,[r[13]||(r[13]=t("label",{class:"block text-sm font-medium text-gray-700 dark:text-gray-300"},"Fecha de Inicio *",-1)),C(t("input",{type:"date","onUpdate:modelValue":r[2]||(r[2]=e=>s(o).inicio=e),class:"mt-1 w-full rounded-md border-gray-300 dark:border-gray-600 dark:bg-gray-900 shadow-sm focus:ring-indigo-500 focus:border-indigo-500"},null,512),[[A,s(o).inicio]]),s(o).errors.inicio?(l(),i("p",Ot,f(s(o).errors.inicio),1)):y("",!0)]),t("div",null,[r[15]||(r[15]=t("label",{class:"block text-sm font-medium text-gray-700 dark:text-gray-300"},"Anticipo (Opcional)",-1)),t("div",Tt,[r[14]||(r[14]=t("div",{class:"absolute inset-y-0 left-0 pl-3 flex items-center pointer-events-none text-gray-500"},"COP",-1)),C(t("input",{type:"number","onUpdate:modelValue":r[3]||(r[3]=e=>s(o).anticipo=e),placeholder:"0",class:"pl-12 w-full rounded-md border-gray-300 dark:border-gray-600 dark:bg-gray-900 shadow-sm focus:ring-indigo-500 focus:border-indigo-500"},null,512),[[A,s(o).anticipo,void 0,{number:!0}]])]),s(o).errors.anticipo?(l(),i("p",It,f(s(o).errors.anticipo),1)):y("",!0)])])]),t("div",Mt,[r[23]||(r[23]=t("div",{class:"p-6 border-b dark:border-gray-700 flex items-center gap-3"},[t("div",{class:"bg-emerald-100 dark:bg-emerald-900/50 p-2 rounded-lg"},[t("svg",{xmlns:"http://www.w3.org/2000/svg",class:"h-6 w-6 text-emerald-600 dark:text-emerald-300",fill:"none",viewBox:"0 0 24 24",stroke:"currentColor"},[t("path",{"stroke-linecap":"round","stroke-linejoin":"round","stroke-width":"2",d:"M3 10h18M7 15h1m4 0h1m-7 4h12a3 3 0 003-3V8a3 3 0 00-3-3H6a3 3 0 00-3 3v8a3 3 0 003 3z"})])]),t("h3",{class:"text-lg font-semibold text-gray-800 dark:text-gray-200"},"Detalles del Pago")],-1)),t("div",St,[t("div",null,[r[17]||(r[17]=t("label",{class:"block text-sm font-medium text-gray-700 dark:text-gray-300"},"Modalidad de Pago *",-1)),t("fieldset",jt,[t("div",Pt,[(l(!0),i(j,null,L(n.modalidades,e=>(l(),i("label",{key:e,class:rt(["relative flex items-center justify-center p-3 rounded-lg border cursor-pointer transition-all",s(o).modalidad===e?"bg-indigo-50 dark:bg-indigo-900/30 border-indigo-500 dark:border-indigo-600 ring-2 ring-indigo-500":"bg-white dark:bg-gray-900/50 border-gray-300 dark:border-gray-600 hover:border-gray-400 dark:hover:border-gray-500"])},[C(t("input",{type:"radio","onUpdate:modelValue":r[4]||(r[4]=a=>s(o).modalidad=a),value:e,class:"hidden"},null,8,Nt),[[st,s(o).modalidad]]),t("span",Vt,f(e.replace("_"," ")),1)],2))),128))])])]),t("div",Ut,[s(o).modalidad==="CUOTAS"||s(o).modalidad==="PAGO_UNICO"||s(o).modalidad==="CUOTA_MIXTA"?(l(),i("div",Et,[t("label",Dt,f(s(o).modalidad==="CUOTA_MIXTA"?"Monto Fijo a Cuotas *":"Monto Total *"),1),t("div",Lt,[r[18]||(r[18]=t("div",{class:"absolute inset-y-0 left-0 pl-3 flex items-center pointer-events-none text-gray-500"},"COP",-1)),C(t("input",{type:"number","onUpdate:modelValue":r[5]||(r[5]=e=>s(o).monto_total=e),placeholder:"5000000",class:"pl-12 w-full rounded-md border-gray-300 dark:border-gray-600 dark:bg-gray-900 shadow-sm focus:ring-indigo-500 focus:border-indigo-500"},null,512),[[A,s(o).monto_total,void 0,{number:!0}]])]),s(o).errors.monto_total?(l(),i("p",Ft,f(s(o).errors.monto_total),1)):y("",!0)])):y("",!0),s(o).modalidad==="CUOTAS"||s(o).modalidad==="CUOTA_MIXTA"?(l(),i("div",$t,[r[19]||(r[19]=t("label",{class:"block text-sm font-medium text-gray-700 dark:text-gray-300"},"Número de Cuotas *",-1)),C(t("input",{type:"number","onUpdate:modelValue":r[6]||(r[6]=e=>s(o).cuotas=e),min:"1",max:"120",step:"1",class:"mt-1 w-full rounded-md border-gray-300 dark:border-gray-600 dark:bg-gray-900 shadow-sm focus:ring-indigo-500 focus:border-indigo-500"},null,512),[[A,s(o).cuotas,void 0,{number:!0}]]),s(o).errors.cuotas?(l(),i("p",Bt,f(s(o).errors.cuotas),1)):y("",!0)])):y("",!0),s(o).modalidad==="LITIS"||s(o).modalidad==="CUOTA_MIXTA"?(l(),i("div",Gt,[r[21]||(r[21]=t("label",{class:"block text-sm font-medium text-gray-700 dark:text-gray-300"},"Porcentaje de Éxito *",-1)),t("div",zt,[C(t("input",{type:"number","onUpdate:modelValue":r[7]||(r[7]=e=>s(o).porcentaje_litis=e),placeholder:"30",class:"pr-8 w-full rounded-md border-gray-300 dark:border-gray-600 dark:bg-gray-900 shadow-sm focus:ring-indigo-500 focus:border-indigo-500"},null,512),[[A,s(o).porcentaje_litis,void 0,{number:!0}]]),r[20]||(r[20]=t("div",{class:"absolute inset-y-0 right-0 pr-3 flex items-center pointer-events-none text-gray-500"},"%",-1))]),s(o).errors.porcentaje_litis?(l(),i("p",Wt,f(s(o).errors.porcentaje_litis),1)):y("",!0)])):y("",!0)]),t("div",null,[r[22]||(r[22]=t("label",{class:"block text-sm font-medium text-gray-700 dark:text-gray-300"},"Nota (Opcional)",-1)),C(t("textarea",{"onUpdate:modelValue":r[8]||(r[8]=e=>s(o).nota=e),rows:"3",class:"mt-1 w-full rounded-md border-gray-300 dark:border-gray-600 dark:bg-gray-900 shadow-sm focus:ring-indigo-500 focus:border-indigo-500"},null,512),[[A,s(o).nota]]),s(o).errors.nota?(l(),i("p",Ht,f(s(o).errors.nota),1)):y("",!0)])])]),t("div",Rt,[t("div",Xt,[r[24]||(r[24]=t("h3",{class:"text-lg font-semibold text-gray-800 dark:text-gray-200"},"Vista Previa del Cronograma",-1)),t("p",Yt,[s(o).modalidad!=="LITIS"?(l(),i("span",qt,"Así se generarán las cuotas para la parte fija del contrato.")):(l(),i("span",Jt,"No se genera cronograma inicial para la modalidad LITIS."))])]),s(o).modalidad!=="LITIS"?(l(),i(j,{key:0},[t("div",Kt,[t("div",Qt,[r[25]||(r[25]=t("span",{class:"text-gray-600 dark:text-gray-300"},"Neto a Cobrar (Parte Fija)",-1)),t("span",Zt,f(v(h.value.neto)),1)])]),t("div",te,[t("table",ee,[r[28]||(r[28]=t("thead",{class:"bg-gray-50 dark:bg-gray-700/50"},[t("tr",null,[t("th",{class:"px-4 py-2 text-left text-xs font-medium text-gray-500 uppercase"},"#"),t("th",{class:"px-4 py-2 text-left text-xs font-medium text-gray-500 uppercase"},"Fecha Vencimiento"),t("th",{class:"px-4 py-2 text-right text-xs font-medium text-gray-500 uppercase"},"Valor Cuota")])],-1)),t("tbody",oe,[h.value.filas.length===0?(l(),i("tr",re,r[26]||(r[26]=[t("td",{colspan:"3",class:"px-4 py-10 text-center text-gray-500"},[t("p",{class:"font-medium"},"Esperando datos..."),t("p",{class:"text-xs"},"Ingresa monto, anticipo e inicio para ver el cronograma.")],-1)]))):y("",!0),(l(!0),i(j,null,L(h.value.filas,e=>(l(),i("tr",{key:e.numero},[t("td",se,f(e.numero),1),t("td",ae,f(e.fecha),1),t("td",ne,f(v(e.valor)),1)]))),128))]),h.value.filas.length>0?(l(),i("tfoot",ie,[t("tr",null,[r[27]||(r[27]=t("th",{colspan:"2",class:"px-4 py-2 text-right text-sm font-semibold"},"Total a Financiar",-1)),t("th",le,f(v(h.value.totalCuotas)),1)])])):y("",!0)])])],64)):(l(),i("div",de,r[29]||(r[29]=[t("svg",{xmlns:"http://www.w3.org/2000/svg",class:"mx-auto h-12 w-12 text-gray-400",fill:"none",viewBox:"0 0 24 24",stroke:"currentColor"},[t("path",{"stroke-linecap":"round","stroke-linejoin":"round","stroke-width":"2",d:"M9 12l2 2 4-4m6 2a9 9 0 11-18 0 9 9 0 0118 0z"})],-1),t("h4",{class:"mt-2 font-semibold"},"Modalidad Litis",-1),t("p",{class:"text-sm"},"El cobro se generará como un cargo único al finalizar el proceso, basado en el porcentaje de éxito.",-1)])))]),t("div",ue,[t("button",{onClick:w,disabled:s(o).processing,class:"w-full inline-flex justify-center items-center gap-2 px-4 py-3 rounded-md text-base font-semibold text-white bg-indigo-600 hover:bg-indigo-700 disabled:opacity-50 transition-colors"}," Guardar Contrato ",8,ce)])])])]),_:1})],64))}};export{xe as default};
