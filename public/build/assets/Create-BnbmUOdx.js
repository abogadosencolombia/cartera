import{s as H,r as _,l as z,k as L,z as R,c as r,o as l,b as w,u as s,h as X,w as C,a as t,i as c,g as M,t as d,d as g,f as p,T as Y,F as y,e as I,n as Z,Z as q,p as J}from"./app-BQ1fBOAU.js";import{_ as K}from"./AuthenticatedLayout-Bawsgd7W.js";import{o as Q}from"./index-C0D_oQT4.js";import"./ApplicationLogo-CLvo8GpJ.js";import"./_plugin-vue_export-helper-DlAUqK2U.js";const W={class:"flex items-center justify-between"},tt={class:"font-semibold text-xl text-gray-800 dark:text-gray-200"},et={class:"flex items-center gap-4"},ot=["disabled"],st={class:"py-8"},at={class:"max-w-4xl mx-auto sm:px-6 lg:px-8 space-y-6"},rt={key:0,class:"bg-amber-50 dark:bg-amber-900/20 border-l-4 border-amber-400 p-4 rounded-md shadow-sm"},lt={class:"flex"},it={class:"ml-3"},nt={class:"mt-1 text-sm text-amber-700 dark:text-amber-400"},dt={class:"bg-white dark:bg-gray-800 shadow sm:rounded-lg"},ct={class:"p-6 grid grid-cols-1 md:grid-cols-2 gap-6"},ut=["disabled"],mt={key:0,class:"mt-1 text-sm text-red-600"},gt={key:0,class:"absolute z-10 mt-1 w-full bg-white dark:bg-gray-900 shadow-lg rounded-md border dark:border-gray-700 max-h-60 overflow-y-auto"},pt={class:"py-1"},xt={key:0,class:"px-4 py-2 text-sm text-gray-500"},bt=["onClick"],yt={key:0,class:"mt-1 text-sm text-red-600"},ft={class:"relative mt-1"},vt={key:0,class:"mt-1 text-sm text-red-600"},kt={class:"bg-white dark:bg-gray-800 shadow sm:rounded-lg"},ht={class:"p-6 space-y-6"},_t={class:"mt-2"},wt={class:"grid grid-cols-2 md:grid-cols-4 gap-3"},Ct=["value"],Mt={class:"text-sm font-medium text-gray-900 dark:text-gray-200"},Ot={class:"grid grid-cols-1 md:grid-cols-2 gap-6 pt-4 border-t dark:border-gray-700"},jt={key:0},It={class:"block text-sm font-medium text-gray-700 dark:text-gray-300"},Tt={class:"relative mt-1"},At={key:0,class:"mt-1 text-sm text-red-600"},Vt={key:1},Nt={key:0,class:"mt-1 text-sm text-red-600"},Ut={key:2},St={class:"relative mt-1"},Dt={key:0,class:"mt-1 text-sm text-red-600"},Ft={key:0,class:"mt-1 text-sm text-red-600"},Pt={class:"bg-white dark:bg-gray-800 shadow sm:rounded-lg"},zt={class:"p-6 border-b dark:border-gray-700"},Lt={class:"text-sm text-gray-500 mt-1"},Bt={key:0},$t={key:1},Et={class:"p-6 space-y-4 text-sm bg-gray-50/50 dark:bg-gray-900/20"},Gt={class:"flex justify-between font-bold text-lg"},Ht={class:"text-emerald-600 dark:text-emerald-400"},Rt={class:"overflow-x-auto"},Xt={class:"min-w-full"},Yt={class:"divide-y divide-gray-200 dark:divide-gray-700"},Zt={key:0},qt={class:"px-4 py-2 text-sm font-mono text-gray-500"},Jt={class:"px-4 py-2 text-sm"},Kt={class:"px-4 py-2 text-sm text-right font-mono"},Qt={key:0,class:"bg-gray-100 dark:bg-gray-700"},Wt={class:"px-4 py-2 text-right text-sm font-semibold font-mono"},te={key:1,class:"p-10 text-center text-gray-500"},ee={class:"bg-white dark:bg-gray-800 shadow sm:rounded-lg p-4"},oe=["disabled"],de={__name:"Create",props:{clientes:{type:Array,default:()=>[]},modalidades:{type:Array,default:()=>[]},plantilla:{type:Object,default:null}},setup(T){const n=T,A=()=>new Date().toISOString().slice(0,10),o=H({cliente_id:null,monto_total:null,anticipo:0,modalidad:"CUOTAS",cuotas:12,inicio:A(),nota:"",porcentaje_litis:null,contrato_origen_id:null}),x=_(""),V=_(""),f=_(!1),N=_(null),U=z(()=>x.value?n.clientes.filter(i=>i.nombre.toLowerCase().includes(x.value.toLowerCase())).slice(0,10):n.clientes.slice(0,10)),S=i=>{o.cliente_id=i.id,V.value=i.nombre,x.value=i.nombre,f.value=!1};L(x,i=>{i!==V.value&&(o.cliente_id=null)}),Q(N,()=>f.value=!1);const O=i=>new Intl.NumberFormat("es-CO",{style:"currency",currency:"COP",maximumFractionDigits:0}).format(Number(i||0));L(()=>o.modalidad,i=>{i==="LITIS"?(o.monto_total=null,o.cuotas=1):i==="PAGO_UNICO"?(o.cuotas=1,o.porcentaje_litis=null):i==="CUOTAS"&&(o.porcentaje_litis=null)}),R(()=>{if(n.plantilla){const i=n.clientes.find(e=>e.id===n.plantilla.cliente_id);o.defaults({cliente_id:n.plantilla.cliente_id,monto_total:n.plantilla.monto_total,anticipo:n.plantilla.anticipo,modalidad:n.plantilla.modalidad,cuotas:12,inicio:A(),nota:`Reestructuración del contrato #${n.plantilla.id}.`,porcentaje_litis:n.plantilla.porcentaje_litis,contrato_origen_id:n.plantilla.id}),o.reset(),i&&S(i)}});const B=(i,e)=>{if(!i)return"";const a=new Date(i.replace(/-/g,"/")),u=a.getDate(),m=new Date(a);m.setMonth(a.getMonth()+e);const v=new Date(m.getFullYear(),m.getMonth()+1,0).getDate();m.setDate(Math.min(u,v));const j=String(m.getMonth()+1).padStart(2,"0"),k=String(m.getDate()).padStart(2,"0");return`${m.getFullYear()}-${j}-${k}`},b=z(()=>{const i=Number(o.monto_total||0),e=Number(o.anticipo||0),a=Math.max(0,i-e),u=Math.max(1,parseInt(o.cuotas||1,10));if(!o.inicio||a<=0||!o.monto_total)return{neto:a,cuotas:u,filas:[],totalCuotas:0};if(o.modalidad==="PAGO_UNICO")return{neto:a,cuotas:1,filas:[{numero:1,fecha:o.inicio,valor:a}],totalCuotas:a};const m=Math.round(a*100),v=Math.floor(m/u),j=m-v*u,k=Array.from({length:u},(F,h)=>{const P=h+1,E=(v+(P<=j?1:0))/100,G=B(o.inicio,h);return{numero:P,fecha:G,valor:E}}),$=k.reduce((F,h)=>F+h.valor,0);return{neto:a,cuotas:u,filas:k,totalCuotas:$}}),D=()=>{o.post(route("honorarios.contratos.store"),{preserveScroll:!0})};return(i,e)=>(l(),r(y,null,[w(s(X),{title:`${n.plantilla?"Reestructurar":"Nuevo"} Contrato · Honorarios`},null,8,["title"]),w(K,null,{header:C(()=>[t("div",W,[t("h2",tt,d(n.plantilla?`Reestructurar Contrato #${n.plantilla.id}`:"Crear Nuevo Contrato"),1),t("div",et,[w(s(J),{href:i.route("honorarios.contratos.index"),class:"text-sm px-3 py-2 rounded-md bg-white dark:bg-gray-700 border border-gray-300 dark:border-gray-600 hover:bg-gray-50 dark:hover:bg-gray-600 flex items-center gap-2"},{default:C(()=>e[9]||(e[9]=[t("svg",{xmlns:"http://www.w3.org/2000/svg",class:"h-4 w-4",fill:"none",viewBox:"0 0 24 24",stroke:"currentColor"},[t("path",{"stroke-linecap":"round","stroke-linejoin":"round","stroke-width":"2",d:"M10 19l-7-7m0 0l7-7m-7 7h18"})],-1),M(" Volver ",-1)])),_:1,__:[9]},8,["href"]),t("button",{onClick:D,disabled:s(o).processing,class:"inline-flex items-center gap-2 px-4 py-2 rounded-md text-sm font-semibold text-white bg-indigo-600 hover:bg-indigo-700 disabled:opacity-50 transition-colors"},e[10]||(e[10]=[t("svg",{xmlns:"http://www.w3.org/2000/svg",class:"h-4 w-4",fill:"none",viewBox:"0 0 24 24",stroke:"currentColor"},[t("path",{"stroke-linecap":"round","stroke-linejoin":"round","stroke-width":"2",d:"M8 7H5a2 2 0 00-2 2v9a2 2 0 002 2h14a2 2 0 002-2V9a2 2 0 00-2-2h-3m-1 4l-3 3m0 0l-3-3m3 3V4"})],-1),M(" Guardar Contrato ",-1)]),8,ot)])])]),default:C(()=>[t("div",st,[t("div",at,[n.plantilla?(l(),r("div",rt,[t("div",lt,[e[14]||(e[14]=t("div",{class:"flex-shrink-0"},[t("svg",{class:"h-5 w-5 text-amber-500",xmlns:"http://www.w3.org/2000/svg",viewBox:"0 0 20 20",fill:"currentColor"},[t("path",{"fill-rule":"evenodd",d:"M18 10a8 8 0 11-16 0 8 8 0 0116 0zm-7-4a1 1 0 11-2 0 1 1 0 012 0zM9 9a1 1 0 000 2v3a1 1 0 001 1h1a1 1 0 100-2v-3a1 1 0 00-1-1H9z","clip-rule":"evenodd"})])],-1)),t("div",it,[e[13]||(e[13]=t("p",{class:"text-sm font-semibold text-amber-800 dark:text-amber-300"},"Modo Reestructuración",-1)),t("p",nt,[e[11]||(e[11]=M(" Estás creando un nuevo contrato basado en el ",-1)),t("strong",null,"#"+d(n.plantilla.id),1),e[12]||(e[12]=M(". Ajusta los valores y la modalidad según sea necesario. ",-1))])])])])):c("",!0),t("div",dt,[e[19]||(e[19]=t("div",{class:"p-6 border-b dark:border-gray-700 flex items-center gap-3"},[t("div",{class:"bg-indigo-100 dark:bg-indigo-900/50 p-2 rounded-lg"},[t("svg",{xmlns:"http://www.w3.org/2000/svg",class:"h-6 w-6 text-indigo-600 dark:text-indigo-300",fill:"none",viewBox:"0 0 24 24",stroke:"currentColor"},[t("path",{"stroke-linecap":"round","stroke-linejoin":"round","stroke-width":"2",d:"M9 12h6m-6 4h6m2 5H7a2 2 0 01-2-2V5a2 2 0 012-2h5.586a1 1 0 01.707.293l5.414 5.414a1 1 0 01.293.707V19a2 2 0 01-2 2z"})])]),t("h3",{class:"text-lg font-semibold text-gray-800 dark:text-gray-200"},"Información Principal")],-1)),t("div",ct,[t("div",{class:"md:col-span-2 relative",ref_key:"clientDropdown",ref:N},[e[15]||(e[15]=t("label",{class:"block text-sm font-medium text-gray-700 dark:text-gray-300"},"Cliente *",-1)),g(t("input",{type:"text","onUpdate:modelValue":e[0]||(e[0]=a=>x.value=a),onFocus:e[1]||(e[1]=a=>f.value=!0),disabled:!!n.plantilla,placeholder:"Escribe para buscar un cliente...",class:"mt-1 w-full rounded-md border-gray-300 dark:border-gray-600 dark:bg-gray-900 shadow-sm focus:ring-indigo-500 focus:border-indigo-500 disabled:bg-gray-100 dark:disabled:bg-gray-800/50"},null,40,ut),[[p,x.value]]),s(o).errors.cliente_id?(l(),r("p",mt,d(s(o).errors.cliente_id),1)):c("",!0),w(Y,{"enter-active-class":"transition ease-out duration-100","enter-from-class":"transform opacity-0 scale-95","enter-to-class":"transform opacity-100 scale-100","leave-active-class":"transition ease-in duration-75","leave-from-class":"transform opacity-100 scale-100","leave-to-class":"transform opacity-0 scale-95"},{default:C(()=>[f.value&&!n.plantilla?(l(),r("div",gt,[t("ul",pt,[U.value.length===0?(l(),r("li",xt,"No hay coincidencias")):c("",!0),(l(!0),r(y,null,I(U.value,a=>(l(),r("li",{key:a.id,onClick:u=>S(a),class:"px-4 py-2 text-sm text-gray-700 dark:text-gray-300 hover:bg-indigo-500 hover:text-white dark:hover:bg-indigo-600 cursor-pointer"},d(a.nombre),9,bt))),128))])])):c("",!0)]),_:1})],512),t("div",null,[e[16]||(e[16]=t("label",{class:"block text-sm font-medium text-gray-700 dark:text-gray-300"},"Fecha de Inicio *",-1)),g(t("input",{type:"date","onUpdate:modelValue":e[2]||(e[2]=a=>s(o).inicio=a),class:"mt-1 w-full rounded-md border-gray-300 dark:border-gray-600 dark:bg-gray-900 shadow-sm focus:ring-indigo-500 focus:border-indigo-500"},null,512),[[p,s(o).inicio]]),s(o).errors.inicio?(l(),r("p",yt,d(s(o).errors.inicio),1)):c("",!0)]),t("div",null,[e[18]||(e[18]=t("label",{class:"block text-sm font-medium text-gray-700 dark:text-gray-300"},"Anticipo (Opcional)",-1)),t("div",ft,[e[17]||(e[17]=t("div",{class:"absolute inset-y-0 left-0 pl-3 flex items-center pointer-events-none text-gray-500"},"COP",-1)),g(t("input",{type:"number","onUpdate:modelValue":e[3]||(e[3]=a=>s(o).anticipo=a),placeholder:"0",class:"pl-12 w-full rounded-md border-gray-300 dark:border-gray-600 dark:bg-gray-900 shadow-sm focus:ring-indigo-500 focus:border-indigo-500"},null,512),[[p,s(o).anticipo,void 0,{number:!0}]])]),s(o).errors.anticipo?(l(),r("p",vt,d(s(o).errors.anticipo),1)):c("",!0)])])]),t("div",kt,[e[26]||(e[26]=t("div",{class:"p-6 border-b dark:border-gray-700 flex items-center gap-3"},[t("div",{class:"bg-emerald-100 dark:bg-emerald-900/50 p-2 rounded-lg"},[t("svg",{xmlns:"http://www.w3.org/2000/svg",class:"h-6 w-6 text-emerald-600 dark:text-emerald-300",fill:"none",viewBox:"0 0 24 24",stroke:"currentColor"},[t("path",{"stroke-linecap":"round","stroke-linejoin":"round","stroke-width":"2",d:"M3 10h18M7 15h1m4 0h1m-7 4h12a3 3 0 003-3V8a3 3 0 00-3-3H6a3 3 0 00-3 3v8a3 3 0 003 3z"})])]),t("h3",{class:"text-lg font-semibold text-gray-800 dark:text-gray-200"},"Detalles del Pago")],-1)),t("div",ht,[t("div",null,[e[20]||(e[20]=t("label",{class:"block text-sm font-medium text-gray-700 dark:text-gray-300"},"Modalidad de Pago *",-1)),t("fieldset",_t,[t("div",wt,[(l(!0),r(y,null,I(T.modalidades,a=>(l(),r("label",{key:a,class:Z(["relative flex items-center justify-center p-3 rounded-lg border cursor-pointer transition-all",s(o).modalidad===a?"bg-indigo-50 dark:bg-indigo-900/30 border-indigo-500 dark:border-indigo-600 ring-2 ring-indigo-500":"bg-white dark:bg-gray-900/50 border-gray-300 dark:border-gray-600 hover:border-gray-400 dark:hover:border-gray-500"])},[g(t("input",{type:"radio","onUpdate:modelValue":e[4]||(e[4]=u=>s(o).modalidad=u),value:a,class:"hidden"},null,8,Ct),[[q,s(o).modalidad]]),t("span",Mt,d(a.replace("_"," ")),1)],2))),128))])])]),t("div",Ot,[s(o).modalidad==="CUOTAS"||s(o).modalidad==="PAGO_UNICO"||s(o).modalidad==="CUOTA_MIXTA"?(l(),r("div",jt,[t("label",It,d(s(o).modalidad==="CUOTA_MIXTA"?"Monto Fijo a Cuotas *":"Monto Total *"),1),t("div",Tt,[e[21]||(e[21]=t("div",{class:"absolute inset-y-0 left-0 pl-3 flex items-center pointer-events-none text-gray-500"},"COP",-1)),g(t("input",{type:"number","onUpdate:modelValue":e[5]||(e[5]=a=>s(o).monto_total=a),placeholder:"5000000",class:"pl-12 w-full rounded-md border-gray-300 dark:border-gray-600 dark:bg-gray-900 shadow-sm focus:ring-indigo-500 focus:border-indigo-500"},null,512),[[p,s(o).monto_total,void 0,{number:!0}]])]),s(o).errors.monto_total?(l(),r("p",At,d(s(o).errors.monto_total),1)):c("",!0)])):c("",!0),s(o).modalidad==="CUOTAS"||s(o).modalidad==="CUOTA_MIXTA"?(l(),r("div",Vt,[e[22]||(e[22]=t("label",{class:"block text-sm font-medium text-gray-700 dark:text-gray-300"},"Número de Cuotas *",-1)),g(t("input",{type:"number","onUpdate:modelValue":e[6]||(e[6]=a=>s(o).cuotas=a),min:"1",max:"120",step:"1",class:"mt-1 w-full rounded-md border-gray-300 dark:border-gray-600 dark:bg-gray-900 shadow-sm focus:ring-indigo-500 focus:border-indigo-500"},null,512),[[p,s(o).cuotas,void 0,{number:!0}]]),s(o).errors.cuotas?(l(),r("p",Nt,d(s(o).errors.cuotas),1)):c("",!0)])):c("",!0),s(o).modalidad==="LITIS"||s(o).modalidad==="CUOTA_MIXTA"?(l(),r("div",Ut,[e[24]||(e[24]=t("label",{class:"block text-sm font-medium text-gray-700 dark:text-gray-300"},"Porcentaje de Éxito *",-1)),t("div",St,[g(t("input",{type:"number","onUpdate:modelValue":e[7]||(e[7]=a=>s(o).porcentaje_litis=a),placeholder:"30",class:"pr-8 w-full rounded-md border-gray-300 dark:border-gray-600 dark:bg-gray-900 shadow-sm focus:ring-indigo-500 focus:border-indigo-500"},null,512),[[p,s(o).porcentaje_litis,void 0,{number:!0}]]),e[23]||(e[23]=t("div",{class:"absolute inset-y-0 right-0 pr-3 flex items-center pointer-events-none text-gray-500"},"%",-1))]),s(o).errors.porcentaje_litis?(l(),r("p",Dt,d(s(o).errors.porcentaje_litis),1)):c("",!0)])):c("",!0)]),t("div",null,[e[25]||(e[25]=t("label",{class:"block text-sm font-medium text-gray-700 dark:text-gray-300"},"Nota (Opcional)",-1)),g(t("textarea",{"onUpdate:modelValue":e[8]||(e[8]=a=>s(o).nota=a),rows:"3",class:"mt-1 w-full rounded-md border-gray-300 dark:border-gray-600 dark:bg-gray-900 shadow-sm focus:ring-indigo-500 focus:border-indigo-500"},null,512),[[p,s(o).nota]]),s(o).errors.nota?(l(),r("p",Ft,d(s(o).errors.nota),1)):c("",!0)])])]),t("div",Pt,[t("div",zt,[e[27]||(e[27]=t("h3",{class:"text-lg font-semibold text-gray-800 dark:text-gray-200"},"Vista Previa del Cronograma",-1)),t("p",Lt,[s(o).modalidad!=="LITIS"?(l(),r("span",Bt,"Así se generarán las cuotas para la parte fija del contrato.")):(l(),r("span",$t,"No se genera cronograma inicial para la modalidad LITIS."))])]),s(o).modalidad!=="LITIS"?(l(),r(y,{key:0},[t("div",Et,[t("div",Gt,[e[28]||(e[28]=t("span",{class:"text-gray-600 dark:text-gray-300"},"Neto a Cobrar (Parte Fija)",-1)),t("span",Ht,d(O(b.value.neto)),1)])]),t("div",Rt,[t("table",Xt,[e[31]||(e[31]=t("thead",{class:"bg-gray-50 dark:bg-gray-700/50"},[t("tr",null,[t("th",{class:"px-4 py-2 text-left text-xs font-medium text-gray-500 uppercase"},"#"),t("th",{class:"px-4 py-2 text-left text-xs font-medium text-gray-500 uppercase"},"Fecha Vencimiento"),t("th",{class:"px-4 py-2 text-right text-xs font-medium text-gray-500 uppercase"},"Valor Cuota")])],-1)),t("tbody",Yt,[b.value.filas.length===0?(l(),r("tr",Zt,e[29]||(e[29]=[t("td",{colspan:"3",class:"px-4 py-10 text-center text-gray-500"},[t("p",{class:"font-medium"},"Esperando datos..."),t("p",{class:"text-xs"},"Ingresa monto, anticipo e inicio para ver el cronograma.")],-1)]))):c("",!0),(l(!0),r(y,null,I(b.value.filas,a=>(l(),r("tr",{key:a.numero},[t("td",qt,d(a.numero),1),t("td",Jt,d(a.fecha),1),t("td",Kt,d(O(a.valor)),1)]))),128))]),b.value.filas.length>0?(l(),r("tfoot",Qt,[t("tr",null,[e[30]||(e[30]=t("th",{colspan:"2",class:"px-4 py-2 text-right text-sm font-semibold"},"Total a Financiar",-1)),t("th",Wt,d(O(b.value.totalCuotas)),1)])])):c("",!0)])])],64)):(l(),r("div",te,e[32]||(e[32]=[t("svg",{xmlns:"http://www.w3.org/2000/svg",class:"mx-auto h-12 w-12 text-gray-400",fill:"none",viewBox:"0 0 24 24",stroke:"currentColor"},[t("path",{"stroke-linecap":"round","stroke-linejoin":"round","stroke-width":"2",d:"M9 12l2 2 4-4m6 2a9 9 0 11-18 0 9 9 0 0118 0z"})],-1),t("h4",{class:"mt-2 font-semibold"},"Modalidad Litis",-1),t("p",{class:"text-sm"},"El cobro se generará como un cargo único al finalizar el proceso, basado en el porcentaje de éxito.",-1)])))]),t("div",ee,[t("button",{onClick:D,disabled:s(o).processing,class:"w-full inline-flex justify-center items-center gap-2 px-4 py-3 rounded-md text-base font-semibold text-white bg-indigo-600 hover:bg-indigo-700 disabled:opacity-50 transition-colors"}," Guardar Contrato ",8,oe)])])])]),_:1})],64))}};export{de as default};
